<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- Script de verificaci√≥n de autenticaci√≥n -->
    <script>
        // Verificar autenticaci√≥n antes de cargar la p√°gina
        (async function checkAuth() {
            try {
                const response = await fetch('/api/auth/check', {
                    credentials: 'include'
                });
                const data = await response.json();
                
                if (!data.authenticated) {
                    window.location.href = '/login.html';
                    return;
                }
                
                // Guardar datos del usuario
                window.currentUser = data.user;
                
            } catch (error) {
                console.error('Error verificando autenticaci√≥n:', error);
                window.location.href = '/login.html';
            }
        })();
    </script>

    <div class="container">
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="logo">
                <img src="images/logo.png" alt="StockMaster" class="logo-icon">
                <span class="logo-text">StockMaster</span>
            </div>

            <ul class="nav-menu">
                <li class="nav-item active" data-section="panel" onclick="showSection('panel')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/>
                        <polyline points="9 22 9 12 15 12 15 22"/>
                    </svg>
                    <span>Panel Principal</span>
                </li>

                <li class="nav-item" data-section="crud" onclick="showSection('crud')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <line x1="9" y1="3" x2="9" y2="21"/>
                    </svg>
                    <span>Productos</span>
                </li>

                <li class="nav-item" data-section="movimientos" onclick="showSection('movimientos')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>
                    </svg>
                    <span>Entradas / Salidas</span>
                </li>

                <li class="nav-item" data-section="pedidos" onclick="showSection('pedidos')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/>
                        <line x1="3" y1="6" x2="21" y2="6"/>
                        <path d="M16 10a4 4 0 0 1-8 0"/>
                    </svg>
                    <span>Pedidos</span>
                </li>

                <li class="nav-item nav-admin-only" data-section="reglas" onclick="showSection('reglas')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="3"/>
                        <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
                    </svg>
                    <span>Reglas de Asignaci√≥n</span>
                </li>

                <li class="nav-item" data-section="dashboard" onclick="showSection('dashboard')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/>
                        <rect x="14" y="3" width="7" height="7"/>
                        <rect x="14" y="14" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/>
                    </svg>
                    <span>Dashboard OLAP</span>
                </li>

                <li class="nav-item" data-section="sucursales" onclick="showSection('sucursales')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/>
                        <circle cx="12" cy="10" r="3"/>
                    </svg>
                    <span>Sucursales</span>
                </li>

                <li class="nav-item" data-section="categorias" onclick="showSection('categorias')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <line x1="8" y1="6" x2="21" y2="6"/>
                        <line x1="8" y1="12" x2="21" y2="12"/>
                        <line x1="8" y1="18" x2="21" y2="18"/>
                        <line x1="3" y1="6" x2="3.01" y2="6"/>
                        <line x1="3" y1="12" x2="3.01" y2="12"/>
                        <line x1="3" y1="18" x2="3.01" y2="18"/>
                    </svg>
                    <span>Categor√≠as</span>
                </li>

                <li class="nav-item" data-section="analisis-temporal" onclick="showSection('analisis-temporal')">
                    <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                        <polyline points="17 6 23 6 23 12"/>
                    </svg>
                    <span>An√°lisis Temporal</span>
                </li>
            </ul>

            <!-- Usuario y Logout -->
            <div style="margin-top: auto; padding: 1.5rem 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 1rem;">
                    <div style="width: 40px; height: 40px; border-radius: 50%; background: linear-gradient(135deg, #05668D 0%, #427AA1 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 1.1rem;">
                        <span id="user-initial">U</span>
                    </div>
                    <div style="flex: 1; min-width: 0;">
                        <div style="font-weight: 600; color: white; font-size: 0.9rem; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;" id="user-name">Usuario</div>
                        <div style="font-size: 0.75rem; color: rgba(255,255,255,0.7);" id="user-email">usuario@email.com</div>
                    </div>
                </div>
                <button onclick="handleLogout()" style="
                    width: 100%;
                    padding: 0.75rem 1rem;
                    background: rgba(239, 68, 68, 0.2);
                    color: #fca5a5;
                    border: 1px solid rgba(239, 68, 68, 0.3);
                    border-radius: 8px;
                    font-weight: 600;
                    font-size: 0.875rem;
                    cursor: pointer;
                    transition: all 0.2s;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    gap: 0.5rem;
                " onmouseover="this.style.background='rgba(239, 68, 68, 0.3)'" onmouseout="this.style.background='rgba(239, 68, 68, 0.2)'">
                    <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                        <polyline points="16 17 21 12 16 7"/>
                        <line x1="21" y1="12" x2="9" y2="12"/>
                    </svg>
                    Cerrar Sesi√≥n
                </button>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Banner de alertas de stock m√≠nimo (visible cuando hay alertas) -->
            <div id="alertas-banner" class="alertas-banner hidden">
                <div class="alertas-banner-content">
                    <span class="alertas-banner-icon">‚ö†Ô∏è</span>
                    <span id="alertas-banner-text">Hay productos bajo punto de reorden</span>
                    <button type="button" class="alertas-banner-btn" onclick="showSection('panel'); document.getElementById('alertas-banner').classList.add('hidden')">Ver panel</button>
                </div>
            </div>

            <!-- Panel Principal (M√©tricas) -->
            <section id="panel-section" class="view-section">
                <header class="page-header">
                    <div>
                        <h1>Panel de M√©tricas</h1>
                        <p class="subtitle">Indicadores clave del almac√©n</p>
                    </div>
                </header>
                <div class="kpi-grid dashboard-metricas">
                    <div class="kpi-card kpi-danger">
                        <div class="kpi-header">
                            <div class="kpi-icon" style="background: rgba(185, 28, 28, 0.12); color: #b91c1c;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
                            </div>
                            <span class="kpi-label">Productos agotados</span>
                        </div>
                        <div class="kpi-value" id="metricas-agotados">0</div>
                    </div>
                    <div class="kpi-card kpi-warning">
                        <div class="kpi-header">
                            <div class="kpi-icon" style="background: rgba(66, 122, 161, 0.15); color: #427AA1;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z"/><line x1="3" y1="6" x2="21" y2="6"/></svg>
                            </div>
                            <span class="kpi-label">√ìrdenes pendientes de surtir</span>
                        </div>
                        <div class="kpi-value" id="metricas-pendientes">0</div>
                    </div>
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon blue">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/></svg>
                            </div>
                            <span class="kpi-label">Ocupaci√≥n del almac√©n</span>
                        </div>
                        <div class="kpi-value" id="metricas-ocupacion">‚Äî</div>
                        <div class="kpi-change neutral"><span id="metricas-unidades">0 unidades</span></div>
                    </div>
                </div>
                <div class="card" style="background: rgba(185, 28, 28, 0.04); border-left: 4px solid #b91c1c;">
                    <h3 style="margin-bottom: 1rem; color: #b91c1c;">‚ö†Ô∏è Alertas de stock m√≠nimo</h3>
                    <div id="panel-alertas-bajo-stock" style="max-height: 280px; overflow-y: auto;">Cargando...</div>
                </div>
            </section>

            <!-- CRUD Section -->
            <section id="crud-section" class="view-section" style="display:none;">
                <header class="page-header">
                    <div>
                        <h1>Operaciones CRUD</h1>
                        <p class="subtitle">Gesti√≥n del esquema transaccional (OLTP)</p>
                    </div>
                </header>

                <!-- B√∫squeda y filtrado -->
                <div class="card">
                    <h3 style="margin-bottom: 1rem;">üîç B√∫squeda y filtrado</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr auto; gap: 1rem; align-items: end;">
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Nombre o c√≥digo</label>
                            <input type="text" id="buscar-producto" class="form-input" placeholder="Buscar por nombre o c√≥digo...">
                        </div>
                        <div class="form-group" style="margin-bottom: 0;">
                            <label class="form-label">Categor√≠a</label>
                            <select id="filtro-categoria" class="form-input">
                                <option value="">Todas</option>
                            </select>
                        </div>
                        <button type="button" class="btn-primary" onclick="aplicarBusquedaProductos()">
                            Buscar
                        </button>
                    </div>
                </div>

                <!-- Formulario de Productos -->
                <div class="card">
                    <h2 style="margin-bottom: 1.5rem;">Agregar/Editar Producto</h2>
                    <form id="product-form">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Nombre del Producto</label>
                                <input type="text" id="nombre" class="form-input" placeholder="Laptop Huawei" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">C√≥digo</label>
                                <input type="text" id="codigo" class="form-input" placeholder="PROD-001" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Categor√≠a</label>
                                <select id="categoria" class="form-input" required>
                                    <option value="">Selecciona una categor√≠a</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Precio Unitario ($)</label>
                                <input type="number" id="precio" class="form-input" placeholder="0.00" step="0.01" min="0" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stock Disponible</label>
                                <input type="number" id="stock" class="form-input" placeholder="0" min="0" value="0" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Punto de reorden</label>
                                <input type="number" id="punto_reorden" class="form-input" placeholder="5" min="0" value="5" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pasillo (ubicaci√≥n)</label>
                                <input type="text" id="pasillo" class="form-input" placeholder="A" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Estante</label>
                                <input type="text" id="estante" class="form-input" placeholder="3" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Nivel</label>
                                <input type="text" id="nivel" class="form-input" placeholder="2" required>
                            </div>
                        </div>

                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button type="submit" class="btn-primary">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                Guardar Producto
                            </button>
                            <button type="button" onclick="resetForm()" class="btn-secondary">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Tabla de Productos -->
                <div class="card">
                    <div class="table-header">
                        <h3>üì¶ Lista de Productos</h3>
                    </div>
                    <div class="table-container">
                        <table id="product-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>C√≥digo</th>
                                    <th>Nombre</th>
                                    <th>Categor√≠a</th>
                                    <th>Ubicaci√≥n</th>
                                    <th>Precio</th>
                                    <th>Stock</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="8" style="text-align: center; padding: 3rem;">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Movimientos (Entradas/Salidas) -->
            <section id="movimientos-section" class="view-section" style="display:none;">
                <header class="page-header">
                    <div>
                        <h1>Control de Entradas y Salidas</h1>
                        <p class="subtitle">Registrar movimientos de inventario</p>
                    </div>
                </header>
                <div class="card">
                    <h2 style="margin-bottom: 1.5rem;">Registrar movimiento</h2>
                    <form id="movimiento-form">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Producto</label>
                                <select id="mov-producto" class="form-input" required>
                                    <option value="">Seleccionar producto</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Tipo</label>
                                <select id="mov-tipo" class="form-input" required>
                                    <option value="entrada_compra">Entrada (Compra)</option>
                                    <option value="entrada_devolucion">Entrada (Devoluci√≥n)</option>
                                    <option value="salida_venta">Salida (Venta)</option>
                                    <option value="salida_baja">Salida (Baja)</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cantidad</label>
                                <input type="number" id="mov-cantidad" class="form-input" min="1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Observaciones</label>
                                <input type="text" id="mov-observaciones" class="form-input" placeholder="Descripci√≥n del movimiento" required>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary" style="margin-top: 1rem;">Registrar movimiento</button>
                    </form>
                </div>
                <div class="card">
                    <h3>Historial de movimientos</h3>
                    <div class="table-container">
                        <table id="movimientos-table">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Producto</th>
                                    <th>Tipo</th>
                                    <th>Cantidad</th>
                                    <th>Observaciones</th>
                                </tr>
                            </thead>
                            <tbody id="movimientos-tbody">
                                <tr><td colspan="5" style="text-align: center;">Cargando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Pedidos y asignaci√≥n -->
            <section id="pedidos-section" class="view-section" style="display:none;">
                <header class="page-header">
                    <div>
                        <h1>Pedidos y Asignaci√≥n</h1>
                        <p class="subtitle">Crear pedidos y ejecutar asignaci√≥n autom√°tica</p>
                    </div>
                </header>
                <div class="card">
                    <h3>Nuevo pedido</h3>
                    <form id="pedido-form">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Producto</label>
                                <select id="pedido-producto" class="form-input" required></select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cantidad solicitada</label>
                                <input type="number" id="pedido-cantidad" class="form-input" min="1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Prioridad (mayor = primero)</label>
                                <input type="number" id="pedido-prioridad" class="form-input" value="0" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cliente / Referencia</label>
                                <input type="text" id="pedido-cliente" class="form-input" placeholder="Nombre o referencia del cliente" required>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Crear pedido</button>
                    </form>
                </div>
                <div class="card">
                    <h3>Pedidos pendientes</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">Ejecutar asignaci√≥n asigna stock disponible a los pedidos seg√∫n la regla activa.</p>
                    <div class="table-container">
                        <table id="pedidos-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Producto</th>
                                    <th>Solicitado</th>
                                    <th>Asignado</th>
                                    <th>Estado</th>
                                    <th>Acci√≥n</th>
                                </tr>
                            </thead>
                            <tbody id="pedidos-tbody">
                                <tr><td colspan="6" style="text-align: center;">Cargando...</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Reglas de asignaci√≥n (solo Admin) -->
            <section id="reglas-section" class="view-section" style="display:none;">
                <header class="page-header">
                    <div>
                        <h1>Reglas de Asignaci√≥n</h1>
                        <p class="subtitle">Configurar criterio para el motor de asignaci√≥n autom√°tica</p>
                    </div>
                </header>
                <div class="card">
                    <div id="reglas-container">Cargando reglas...</div>
                </div>
            </section>

            <!-- Dashboard Section -->
            <section id="dashboard-section" class="view-section" style="display:none;">
                <header class="page-header">
                    <div>
                        <h1>Dashboard Multidimensional</h1>
                        <p class="subtitle">An√°lisis de KPIs basados en el Cubo OLAP y metodolog√≠a Kimball.</p>
                    </div>
                </header>

                <!-- Botones de Exportaci√≥n -->
                <div class="card" style="margin-bottom: 2rem; background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);">
                    <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h3 style="margin: 0 0 0.5rem 0; color: var(--primary);">üìä Exportar Reportes</h3>
                            <p style="margin: 0; color: var(--text-secondary); font-size: 0.9rem;">Descarga el an√°lisis completo en diferentes formatos</p>
                        </div>
                        <div style="display: flex; gap: 0.75rem; flex-wrap: wrap;">
                            <button onclick="exportarPDF()" class="btn-export" style="background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);">
                                <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="16" y1="13" x2="8" y2="13"/>
                                    <line x1="16" y1="17" x2="8" y2="17"/>
                                    <polyline points="10 9 9 9 8 9"/>
                                </svg>
                                PDF
                            </button>
                            <button onclick="exportarExcel()" class="btn-export" style="background: linear-gradient(135deg, #208B3A 0%, #1a6b2e 100%);">
                                <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="12" y1="18" x2="12" y2="12"/>
                                    <line x1="9" y1="15" x2="15" y2="15"/>
                                </svg>
                                Excel
                            </button>
                            <button onclick="exportarCSV()" class="btn-export" style="background: linear-gradient(135deg, #05668D 0%, #427AA1 100%);">
                                <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                </svg>
                                CSV
                            </button>
                            <button onclick="exportarJSON()" class="btn-export" style="background: linear-gradient(135deg, #427AA1 0%, #05668D 100%);">
                                <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                                    <polyline points="14 2 14 8 20 8"/>
                                    <line x1="9" y1="15" x2="15" y2="15"/>
                                </svg>
                                JSON
                            </button>
                            <button onclick="exportarHTML()" class="btn-export" style="background: linear-gradient(135deg, #96E072 0%, #208B3A 100%);">
                                <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="16 18 22 12 16 6"/>
                                    <polyline points="8 6 2 12 8 18"/>
                                </svg>
                                HTML
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Panel de Alertas y Acciones -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    
                    <!-- Bot√≥n de Refrescar Cubo -->
                    <div class="card" style="background: linear-gradient(135deg, rgba(59, 130, 246, 0.05) 0%, rgba(139, 92, 246, 0.05) 100%);">
                        <h3 style="margin-bottom: 1rem; color: var(--primary);">üîÑ Actualizaci√≥n del Cubo</h3>
                        <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1.5rem;">
                            Sincroniza los datos del sistema transaccional con el Data Warehouse
                        </p>
                        <button onclick="refrescarCuboOLAP()" style="
                            width: 100%;
                            padding: 1rem;
                            background: linear-gradient(135deg, var(--primary) 0%, var(--cerulean) 100%);
                            color: white;
                            border: none;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            gap: 0.5rem;
                            transition: all 0.2s;
                        " onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 20px rgba(59, 130, 246, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'">
                            <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 4 23 10 17 10"/>
                                <polyline points="1 20 1 14 7 14"/>
                                <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                            </svg>
                            Refrescar Cubo OLAP
                        </button>
                    </div>

                    <!-- Alertas de Bajo Stock -->
                    <div class="card" style="background: rgba(185, 28, 28, 0.03); border-left: 4px solid #b91c1c;">
                        <h3 style="margin-bottom: 1rem; color: #b91c1c;">‚ö†Ô∏è Alertas de Inventario</h3>
                        <div id="alertas-bajo-stock" style="max-height: 300px; overflow-y: auto;">
                            <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                                Cargando alertas...
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Productos Estrella -->
                <div class="card">
                    <div style="margin-bottom: 1.5rem;">
                        <h3 style="margin-bottom: 0.5rem; color: var(--primary);">‚≠ê Productos Estrella (Mayor Crecimiento)</h3>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">
                            Top 3 productos con mayor crecimiento porcentual respecto al mes anterior
                        </p>
                    </div>
                    <div id="productos-estrella-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            Cargando datos...
                        </div>
                    </div>
                </div>

                <!-- KPIs Principales -->
                <div class="kpi-grid">
                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon blue">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <line x1="12" y1="1" x2="12" y2="23"/>
                                    <path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                </svg>
                            </div>
                            <span class="kpi-label">Total Ventas</span>
                        </div>
                        <div class="kpi-value" id="total-monto">$0.00</div>
                        <div class="kpi-change positive">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/>
                                <polyline points="17 6 23 6 23 12"/>
                            </svg>
                            <span>+0% vs periodo anterior</span>
                        </div>
                    </div>

                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon purple">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="1" y="4" width="22" height="16" rx="2" ry="2"/>
                                    <line x1="1" y1="10" x2="23" y2="10"/>
                                </svg>
                            </div>
                            <span class="kpi-label">Unidades Vendidas</span>
                        </div>
                        <div class="kpi-value" id="total-qty">0</div>
                        <div class="kpi-change neutral">
                            <span>Sin cambios</span>
                        </div>
                    </div>

                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon" style="background: rgba(32, 139, 58, 0.12); color: #208B3A;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 2v20M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>
                                </svg>
                            </div>
                            <span class="kpi-label">Promedio por Transacci√≥n</span>
                        </div>
                        <div class="kpi-value" id="promedio-transaccion">$0.00</div>
                        <div class="kpi-change neutral">
                            <span id="num-transacciones">0 transacciones</span>
                        </div>
                    </div>

                    <div class="kpi-card">
                        <div class="kpi-header">
                            <div class="kpi-icon" style="background: rgba(66, 122, 161, 0.12); color: #427AA1;">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"/>
                                    <polyline points="3.27 6.96 12 12.01 20.73 6.96"/>
                                    <line x1="12" y1="22.08" x2="12" y2="12"/>
                                </svg>
                            </div>
                            <span class="kpi-label">Productos √önicos</span>
                        </div>
                        <div class="kpi-value" id="productos-unicos">0</div>
                        <div class="kpi-change neutral">
                            <span id="sucursales-activas">0 sucursales activas</span>
                        </div>
                    </div>
                </div>

                <!-- Gr√°fico Principal: Ventas por Categor√≠a -->
                <div class="card chart-card">
                    <div class="chart-header">
                        <h3>Ventas por Categor√≠a</h3>
                        <div class="chart-legend">
                            <span class="legend-item">
                                <span class="legend-dot"></span>
                                Ventas ($)
                            </span>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="ventasChart"></canvas>
                    </div>
                </div>

                <!-- Gr√°ficos Adicionales en Grid -->
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 1.5rem; margin-bottom: 2rem;">
                    
                    <!-- Top 5 Productos -->
                    <div class="card chart-card">
                        <div class="chart-header">
                            <h3>üèÜ Top 5 Productos M√°s Vendidos</h3>
                        </div>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="topProductosChart"></canvas>
                        </div>
                    </div>

                    <!-- Ventas por Sucursal -->
                    <div class="card chart-card">
                        <div class="chart-header">
                            <h3>üè™ Ranking de Sucursales</h3>
                        </div>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="sucursalesChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Tendencia Mensual -->
                <div class="card chart-card">
                    <div class="chart-header">
                        <h3>üìà Tendencia de Ventas Mensual (2024)</h3>
                        <div class="chart-legend">
                            <span class="legend-item">
                                <span class="legend-dot"></span>
                                Ventas Mensuales
                            </span>
                        </div>
                    </div>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="tendenciaChart"></canvas>
                    </div>
                </div>

                <!-- Ventas por Regi√≥n -->
                <div class="card chart-card">
                    <div class="chart-header">
                        <h3>üåç An√°lisis por Regi√≥n Geogr√°fica</h3>
                    </div>
                    <div class="chart-container" style="height: 300px;">
                        <canvas id="regionChart"></canvas>
                    </div>
                </div>

                <!-- Tabla de An√°lisis Detallado -->
                <div class="card">
                    <div class="table-header">
                        <h3>üìä An√°lisis Detallado por Producto</h3>
                    </div>
                    <div class="table-container">
                        <table id="analisis-table">
                            <thead>
                                <tr>
                                    <th>Ranking</th>
                                    <th>Producto</th>
                                    <th>Categor√≠a</th>
                                    <th>Total Ventas</th>
                                    <th>Unidades</th>
                                    <th>Transacciones</th>
                                </tr>
                            </thead>
                            <tbody id="analisis-tbody">
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 2rem;">Cargando datos...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Gesti√≥n de Sucursales Section -->
            <section id="sucursales-section" class="view-section" style="display:none;">
                <header class="page-header">
                    <div>
                        <h1>Gesti√≥n de Sucursales</h1>
                        <p class="subtitle">Administra las ubicaciones de tu negocio</p>
                    </div>
                </header>

                <!-- Formulario de Sucursales -->
                <div class="card">
                    <h2 style="margin-bottom: 1.5rem;">Agregar/Editar Sucursal</h2>
                    <form id="sucursal-form">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem;">
                            <div class="form-group">
                                <label class="form-label">Nombre de la Sucursal</label>
                                <input type="text" id="nombre-sucursal" class="form-input" placeholder="Sucursal Centro" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ciudad</label>
                                <input type="text" id="ciudad-sucursal" class="form-input" placeholder="Ciudad de M√©xico" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Estado</label>
                                <input type="text" id="estado-sucursal" class="form-input" placeholder="CDMX" required>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Regi√≥n</label>
                                <select id="region-sucursal" class="form-input" required>
                                    <option value="">Selecciona una regi√≥n</option>
                                    <option value="Norte">Norte</option>
                                    <option value="Sur">Sur</option>
                                    <option value="Centro">Centro</option>
                                    <option value="Occidente">Occidente</option>
                                    <option value="Oriente">Oriente</option>
                                </select>
                            </div>
                        </div>

                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button type="submit" class="btn-primary">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                Guardar Sucursal
                            </button>
                            <button type="button" onclick="resetSucursalForm()" class="btn-secondary">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Tabla de Sucursales -->
                <div class="card">
                    <div class="table-header">
                        <h3>üìç Lista de Sucursales</h3>
                    </div>
                    <div class="table-container">
                        <table id="sucursal-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Ciudad</th>
                                    <th>Estado</th>
                                    <th>Regi√≥n</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="6" style="text-align: center; padding: 3rem;">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- Gesti√≥n de Categor√≠as Section -->
            <section id="categorias-section" class="view-section" style="display:none;">
                <header class="page-header">
                    <div>
                        <h1>Gesti√≥n de Categor√≠as</h1>
                        <p class="subtitle">Administra las categor√≠as de productos</p>
                    </div>
                </header>

                <!-- Formulario de Categor√≠as -->
                <div class="card">
                    <h2 style="margin-bottom: 1.5rem;">Agregar/Editar Categor√≠a</h2>
                    <form id="categoria-form">
                        <div class="form-group">
                            <label class="form-label">Nombre de la Categor√≠a</label>
                            <input type="text" id="nombre-categoria" class="form-input" placeholder="Electr√≥nica" required>
                        </div>

                        <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                            <button type="submit" class="btn-primary">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/>
                                    <polyline points="17 21 17 13 7 13 7 21"/>
                                    <polyline points="7 3 7 8 15 8"/>
                                </svg>
                                Guardar Categor√≠a
                            </button>
                            <button type="button" onclick="resetCategoriaForm()" class="btn-secondary">
                                Cancelar
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Tabla de Categor√≠as -->
                <div class="card">
                    <div class="table-header">
                        <h3>üìã Lista de Categor√≠as</h3>
                    </div>
                    <div class="table-container">
                        <table id="categoria-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Nombre</th>
                                    <th>Acciones</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td colspan="3" style="text-align: center; padding: 3rem;">Cargando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- SECCI√ìN 5: AN√ÅLISIS TEMPORAL AVANZADO -->
            <section id="analisis-temporal-section" class="view-section" style="display:none;">
                <header class="page-header">
                    <div>
                        <h1>üìà An√°lisis Temporal Avanzado</h1>
                        <p class="subtitle">Navegaci√≥n multidimensional por jerarqu√≠as temporales</p>
                    </div>
                </header>

                <!-- Botones de Exportaci√≥n -->
                <div style="display: flex; gap: 1rem; margin-bottom: 2rem; flex-wrap: wrap;">
                    <button onclick="exportarTemporalPDF()" class="btn-export" style="background: linear-gradient(135deg, #b91c1c 0%, #991b1b 100%);">
                        <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <line x1="16" y1="13" x2="8" y2="13"/>
                            <line x1="16" y1="17" x2="8" y2="17"/>
                            <polyline points="10 9 9 9 8 9"/>
                        </svg>
                        Exportar PDF
                    </button>

                    <button onclick="exportarTemporalExcel()" class="btn-export" style="background: linear-gradient(135deg, #208B3A 0%, #1a6b2e 100%);">
                        <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <path d="M12 18v-6"/>
                            <path d="M9 15h6"/>
                        </svg>
                        Exportar Excel
                    </button>

                    <button onclick="exportarTemporalCSV()" class="btn-export" style="background: linear-gradient(135deg, #427AA1 0%, #05668D 100%);">
                        <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                        </svg>
                        Exportar CSV
                    </button>

                    <button onclick="exportarTemporalJSON()" class="btn-export" style="background: linear-gradient(135deg, #96E072 0%, #208B3A 100%);">
                        <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                            <polyline points="14 2 14 8 20 8"/>
                            <path d="M10 12h4"/>
                            <path d="M10 16h4"/>
                        </svg>
                        Exportar JSON
                    </button>

                    <button onclick="exportarTemporalHTML()" class="btn-export" style="background: linear-gradient(135deg, #05668D 0%, #427AA1 100%);">
                        <svg style="width: 18px; height: 18px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <polyline points="16 18 22 12 16 6"/>
                            <polyline points="8 6 2 12 8 18"/>
                        </svg>
                        Exportar HTML
                    </button>
                </div>

                <div class="card">
                    <h3>Selecciona el Nivel de An√°lisis</h3>
                    <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                        Utiliza las operaciones de Roll-Up (‚Üë) y Drill-Down (‚Üì) para navegar por la jerarqu√≠a temporal
                    </p>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 2rem;">
                        <button class="btn-nivel" onclick="loadAnalisisTemporal('dia')">
                            <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="12" cy="12" r="10"/>
                                <polyline points="12 6 12 12 16 14"/>
                            </svg>
                            Por D√≠a
                        </button>

                        <button class="btn-nivel active" onclick="loadAnalisisTemporal('mes')">
                            <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                            </svg>
                            Por Mes
                        </button>

                        <button class="btn-nivel" onclick="loadAnalisisTemporal('trimestre')">
                            <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="3" width="7" height="7"/>
                                <rect x="14" y="3" width="7" height="7"/>
                                <rect x="14" y="14" width="7" height="7"/>
                                <rect x="3" y="14" width="7" height="7"/>
                            </svg>
                            Por Trimestre
                        </button>

                        <button class="btn-nivel" onclick="loadAnalisisTemporal('anio')">
                            <svg style="width: 20px; height: 20px;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                                <line x1="16" y1="2" x2="16" y2="6"/>
                                <line x1="8" y1="2" x2="8" y2="6"/>
                                <line x1="3" y1="10" x2="21" y2="10"/>
                                <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01"/>
                            </svg>
                            Por A√±o
                        </button>
                    </div>
                </div>

                <!-- Gr√°fico -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h3>üìä Evoluci√≥n de Ventas</h3>
                    </div>
                    <div class="chart-container">
                        <canvas id="analisisTemporalChart"></canvas>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Librer√≠as CDN para exportaci√≥n -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Scripts del proyecto -->
    <script src="export.js"></script>
    <script src="app.js"></script>
</body>
</html>